<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fibonacci Football League – Standings</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
<header>
  <h1>Fibonacci Football League – Standings</h1>
</header>
<main>
  <div class="card">
    <h2>Table</h2>
    <div class="muted" id="meta"></div>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Team</th>
          <th class="muted">ESPN ID</th>
          <th>FFL Pts</th>
          <th class="muted">Raw Pts (sum)</th>
          <th class="muted">Played</th>
          <th class="muted">Last Week</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</main>
<script>
async function loadStandings(){
  try {
    const res = await fetch('/api/standings');
    if (!res.ok) throw new Error("API error " + res.status);
    const data = await res.json();
    document.getElementById('meta').textContent = 
      data.latestWeek != null ? ('Through Week ' + (data.latestWeek+1)) : 'No weeks calculated yet.';
    const tb = document.getElementById('tbody');
    tb.innerHTML = '';
    data.rows.forEach((r, idx) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${idx+1}</td>
        <td>${r.name}</td>
        <td class="muted">${r.espnId ? '<span class="pill">'+r.espnId+'</span>' : ''}</td>
        <td><strong>${r.seasonPts}</strong></td>
        <td class="muted">${Number(r.rawSum).toFixed(2)}</td>
        <td class="muted">${r.played}</td>
        <td class="muted">${r.lastWeek == null ? '-' : r.lastWeek}</td>
      `;
      tb.appendChild(tr);
    });
  } catch (err) {
    document.getElementById('meta').textContent = "Error loading standings: " + err.message;
  }
}
loadStandings();
</script>
</body>
</html>

